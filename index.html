<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SongSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide scrollbar */
        ::-webkit-scrollbar {
            display: none;
        }
        /* Add a subtle transition for the now playing bar */
        #nowPlayingBar {
            transition: transform 0.3s ease-in-out;
        }
        .song-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .song-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-black text-white antialiased">

    <!-- Main Container -->
    <div id="app" class="min-h-screen flex flex-col pb-28">

        <!-- Header -->
        <header class="py-6 px-4 sm:px-6 lg:px-8 bg-black sticky top-0 z-10 border-b border-gray-800">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <h1 id="logo" class="text-2xl sm:text-3xl font-bold tracking-tight text-white cursor-pointer">
                    <span class="text-red-600">SONG</span>SPHERE
                </h1>
                <form id="searchForm" class="w-full max-w-md">
                    <div class="relative">
                        <!-- Search Icon -->
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </div>
                        <input id="searchInput" type="search" class="block w-full pl-10 pr-3 py-2.5 border border-gray-700 rounded-lg leading-5 bg-gray-800 text-gray-200 placeholder-gray-400 focus:outline-none focus:bg-gray-700 focus:border-red-600 focus:ring-1 focus:ring-red-600 transition" placeholder="Search for songs, artists..." autocomplete="off">
                    </div>
                </form>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div id="results-header" class="mb-6">
                     <h2 id="results-title" class="text-2xl font-semibold text-gray-300">Discover new music</h2>
                     <p id="results-count" class="text-gray-400 mt-1"></p>
                </div>

                <!-- Initial Message -->
                <div id="initial-message" class="hidden text-center py-16">
                    <svg class="mx-auto h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3" />
                    </svg>
                    <h3 class="mt-2 text-lg font-medium text-gray-300">Your next favorite song is here</h3>
                    <p class="mt-1 text-sm text-gray-500">Use the search bar above to find artists and songs.</p>
                </div>

                <!-- Loading Spinner -->
                <div id="loader" class="hidden flex justify-center items-center py-16">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"></div>
                </div>

                <!-- Results Grid -->
                <div id="resultsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 sm:gap-6"></div>

                <!-- No Results Message -->
                <div id="noResults" class="hidden text-center py-16">
                    <svg class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3" /></svg>
                    <h3 class="mt-2 text-lg font-medium text-gray-300">No results found</h3>
                    <p class="mt-1 text-sm text-gray-500">Try searching for something else.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Now Playing Footer -->
    <footer id="nowPlayingBar" class="fixed bottom-0 left-0 right-0 bg-gray-800/70 backdrop-blur-lg border-t border-gray-700 transform translate-y-full z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-24">
                <div class="flex items-center space-x-4 min-w-0">
                    <img id="nowPlayingArt" src="https://placehold.co/64x64/1f2937/4b5563?text=Music" alt="Album Art" class="h-16 w-16 rounded-md shadow-lg object-cover">
                    <div class="min-w-0">
                        <p id="nowPlayingTitle" class="text-white font-semibold truncate">Select a song</p>
                        <p id="nowPlayingArtist" class="text-gray-400 text-sm truncate">to start listening</p>
                    </div>
                </div>
                <div class="flex-grow flex justify-center mx-4">
                     <audio id="audioPlayer" controls class="w-full max-w-xl"></audio>
                </div>
            </div>
        </div>
    </footer>

    <!-- Error Modal -->
    <div id="errorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
            </div>
            <h3 class="mt-4 text-lg leading-6 font-medium text-white" id="errorTitle">Error</h3>
            <div class="mt-2">
                <p class="text-sm text-gray-400" id="errorMessage">Something went wrong.</p>
            </div>
            <div class="mt-5">
                <button id="closeErrorModal" type="button" class="inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-gray-800 sm:text-sm">Got it, thanks!</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Element Cache ---
        const elements = {
            logo: document.getElementById('logo'),
            searchForm: document.getElementById('searchForm'),
            searchInput: document.getElementById('searchInput'),
            resultsGrid: document.getElementById('resultsGrid'),
            loader: document.getElementById('loader'),
            noResults: document.getElementById('noResults'),
            resultsCount: document.getElementById('results-count'),
            resultsTitle: document.getElementById('results-title'),
            initialMessage: document.getElementById('initial-message'),
            nowPlayingBar: document.getElementById('nowPlayingBar'),
            nowPlayingArt: document.getElementById('nowPlayingArt'),
            nowPlayingTitle: document.getElementById('nowPlayingTitle'),
            nowPlayingArtist: document.getElementById('nowPlayingArtist'),
            audioPlayer: document.getElementById('audioPlayer'),
            errorModal: document.getElementById('errorModal'),
            errorTitle: document.getElementById('errorTitle'),
            errorMessage: document.getElementById('errorMessage'),
            closeErrorModal: document.getElementById('closeErrorModal'),
        };

        // --- Robustness Check ---
        for (const key in elements) {
            if (!elements[key]) {
                console.error(`Initialization failed: Element with ID '${key}' not found.`);
                document.body.innerHTML = '<div class="text-white text-center p-8">A critical error occurred. Could not initialize the application.</div>';
                return; 
            }
        }

        // --- API Search Function ---
        const searchMusic = async (term, isInitialSearch = false) => {
            elements.initialMessage.classList.add('hidden');
            elements.resultsGrid.innerHTML = '';
            elements.noResults.classList.add('hidden');
            elements.loader.classList.remove('hidden');
            
            elements.resultsTitle.textContent = 'Discover new music';
            elements.resultsCount.textContent = ''; // Clear previous counts

            try {
                const apiUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(term)}&entity=song&limit=52`;
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                displayResults(data.results);
            } catch (error) {
                console.error('Search failed:', error);
                showError('Search Failed', 'Could not fetch music data. Please check your connection and try again.');
                elements.resultsCount.textContent = '';
            } finally {
                elements.loader.classList.add('hidden');
            }
        };

        // --- Display Results Function ---
        const displayResults = (songs) => {
            if (songs.length === 0) {
                elements.noResults.classList.remove('hidden');
                elements.resultsCount.textContent = '';
                return;
            }
            elements.resultsCount.textContent = ''; // Ensure no count is displayed
            songs.forEach(song => {
                const card = document.createElement('div');
                card.className = 'song-card bg-gray-800 rounded-lg overflow-hidden group flex flex-col justify-between';
                
                const spotifyQuery = encodeURIComponent(`${song.trackName} ${song.artistName}`);
                const youtubeQuery = encodeURIComponent(`${song.trackName} ${song.artistName}`);

                card.innerHTML = `
                    <div class="cursor-pointer" data-action="play">
                        <div class="relative">
                            <img src="${song.artworkUrl100.replace('100x100bb', '400x400bb')}" alt="${song.trackName}" class="w-full h-auto aspect-square object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/1f2937/4b5563?text=Error';">
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center">
                                <svg class="h-12 w-12 text-white opacity-0 group-hover:opacity-100 transform scale-75 group-hover:scale-100 transition-all duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                            </div>
                        </div>
                        <div class="p-3">
                            <p class="text-white font-semibold truncate text-sm">${song.trackName}</p>
                            <p class="text-gray-400 truncate text-xs">${song.artistName}</p>
                        </div>
                    </div>
                    <div class="p-2 flex items-center justify-center space-x-1">
                        <a href="${song.trackViewUrl}" target="_blank" rel="noopener noreferrer" class="platform-link flex-1 text-center bg-gray-600 hover:bg-gray-700 text-white text-xs font-bold py-2 px-2 rounded-md transition-colors duration-300">Apple</a>
                        <a href="https://open.spotify.com/search/${spotifyQuery}" target="_blank" rel="noopener noreferrer" class="platform-link flex-1 text-center bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 px-2 rounded-md transition-colors duration-300">Spotify</a>
                        <a href="https://music.youtube.com/search?q=${youtubeQuery}" target="_blank" rel="noopener noreferrer" class="platform-link flex-1 text-center bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 px-2 rounded-md transition-colors duration-300">YouTube</a>
                    </div>`;
                
                // Add event listener to the card itself to play the preview
                const playArea = card.querySelector('[data-action="play"]');
                if (playArea) {
                    playArea.addEventListener('click', () => playSong(song));
                }

                elements.resultsGrid.appendChild(card);
            });
        };
        
        // --- Play Song Function ---
        const playSong = (songData) => {
            elements.nowPlayingArt.src = songData.artworkUrl100.replace('100x100bb', '400x400bb');
            elements.nowPlayingTitle.textContent = songData.trackName;
            elements.nowPlayingArtist.textContent = songData.artistName;
            elements.audioPlayer.src = songData.previewUrl;
            elements.audioPlayer.play().catch(e => {
                console.error("Audio play failed:", e);
                showError("Playback Error", "Could not play the audio preview.");
            });
            elements.nowPlayingBar.classList.remove('translate-y-full');
        };

        // --- Error Modal Logic ---
        const showError = (title, message) => {
            elements.errorTitle.textContent = title;
            elements.errorMessage.textContent = message;
            elements.errorModal.classList.remove('hidden');
        };

        // --- Event Listeners ---
        elements.logo.addEventListener('click', () => {
            searchMusic('Daft Punk', true);
        });

        elements.searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const searchTerm = elements.searchInput.value.trim();
            if (searchTerm) searchMusic(searchTerm);
        });
        
        elements.closeErrorModal.addEventListener('click', () => {
            elements.errorModal.classList.add('hidden');
        });
        
        // --- Initial Load ---
        searchMusic('Daft Punk', true);
    });
    </script>
</body>
</html>
